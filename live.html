<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>전사 라이브 파일럿 - LIVE</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:0; background:#0b1220; color:#e9eefc; }
    .bar { display:flex; justify-content:space-between; align-items:center; gap:12px; padding:12px 14px; border-bottom:1px solid #23304d; background:#0f172a; position:sticky; top:0; z-index:10;}
    .pill { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid #2a3b61; border-radius:999px; background:#121b2e; }
    .wrap { display:grid; grid-template-columns: 1.6fr 1fr; gap:12px; padding:12px; max-width: 1200px; margin: 0 auto; }
    .card { background:#121b2e; border:1px solid #23304d; border-radius:14px; overflow:hidden; }
    .card h3 { margin:0; padding:12px 14px; border-bottom:1px solid #23304d; }
    .content { padding: 12px 14px; }
    iframe { width:100%; aspect-ratio: 16/9; border:0; display:block; background:#000; }
    .chatBox { height: calc(100vh - 220px); overflow:auto; padding: 12px 14px; }
    .msg { margin:0 0 10px 0; }
    .meta { color:#a9b7da; font-size:12px; }
    .inputRow { display:flex; gap:10px; padding: 12px 14px; border-top:1px solid #23304d; }
    input { flex:1; padding:12px; border-radius:10px; border:1px solid #2a3b61; background:#0f172a; color:#e9eefc; }
    button { padding:12px 14px; border-radius:10px; border:none; background:#2b59ff; color:#fff; font-weight:700; cursor:pointer; }
    .rightTop { display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
    .muted { color:#a9b7da; font-size: 12px; }
    .link { color:#9db4ff; text-decoration:none; }
    @media (max-width: 980px) { .wrap { grid-template-columns: 1fr; } .chatBox { height: 40vh; } }
  </style>
</head>
<body>
  <div class="bar">
    <div style="display:flex; gap:10px; align-items:center;">
      <strong>ON AIR</strong>
      <span class="pill" id="eventTitle">전사 라이브 파일럿</span>
      <span class="pill" id="approxOnline">최근 1분 접속: -</span>
    </div>
    <div class="rightTop">
      <div class="pill" id="userCard">접속자 정보 로딩중…</div>
      <div class="muted">
        <a class="link" href="./stats.html">통계</a> ·
        <a class="link" href="#" id="btnLogout">로그아웃</a>
      </div>
    </div>
  </div>

  <!-- 접속 정보 모달 --> 
<div id="joinModal" style="position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:9999;">
  <div style="width:min(560px,calc(100% - 24px));background:#121b2e;border:1px solid #23304d;border-radius:14px;padding:16px;">
    <h3 style="margin:0 0 10px 0;">접속 정보 확인</h3>

    <!-- STEP 1 -->
    <div id="stepEnv">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px;">
        <label><input type="radio" name="env" value="internal" checked> 사내</label>
        <label><input type="radio" name="env" value="external"> 사외</label>
        <span style="opacity:.6;">|</span>
        <label><input id="isMobileChk" type="checkbox"> 모바일 접속</label>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:10px;">
        <button id="btnEnvNext">다음</button>
      </div>
    </div>

    <!-- STEP 2 (leader only) -->
    <div id="stepLeader" style="display:none;">
      <div style="margin-bottom:10px;font-weight:700;">팀장 보기 방식</div>
      <div style="display:flex;gap:16px;align-items:center;margin-bottom:12px;">
        <label><input type="radio" name="leaderMode" value="solo" checked> 혼자 보기</label>
        <label><input type="radio" name="leaderMode" value="group"> 함께 보기</label>
      </div>

      <div id="memberPicker" style="display:none;border:1px solid #23304d;border-radius:10px;padding:10px;max-height:260px;overflow:auto;margin-bottom:12px;">
        <div style="margin-bottom:6px;opacity:.8;">같이 보는 팀원 선택</div>
        <div id="memberList"></div>
        <div style="margin-top:8px;font-size:12px;color:#a9b7da;">
          * 이미 개별 접속 중인 팀원은 선택할 수 없습니다.
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:10px;">
        <button id="btnLeaderBack">이전</button>
        <button id="btnLeaderConfirm">확인</button>
      </div>
    </div>

    <div style="margin-top:10px;color:#a9b7da;font-size:12px;">
      확인을 눌러야 라이브 영상이 재생됩니다.
    </div>
  </div>
</div>
<button id="btnGroupEdit" style="display:none;">같이보기 설정</button>
<div id="teamOnlineText" style="font-size:12px;opacity:.85;"></div>
<button id="btnOrgStatus" style="display:none;">조직접속현황</button>
  <!-- STEP 3 (top)-->
   <div id="orgModal" style="position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:9999;">
  <div style="width:min(720px,calc(100% - 24px));background:#121b2e;border:1px solid #23304d;border-radius:14px;padding:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <h3 style="margin:0;">조직 접속 현황</h3>
      <button id="btnOrgClose">닫기</button>
    </div>

    <div style="margin-top:12px;max-height:420px;overflow:auto;border:1px solid #23304d;border-radius:10px;">
      <table style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="position:sticky;top:0;background:#121b2e;">
            <th style="text-align:left;padding:10px;border-bottom:1px solid #23304d;">팀</th>
            <th style="text-align:left;padding:10px;border-bottom:1px solid #23304d;">팀장</th>
            <th style="text-align:left;padding:10px;border-bottom:1px solid #23304d;">팀원</th>
          </tr>
        </thead>
        <tbody id="orgTbody"></tbody>
      </table>
    </div>

    <div style="margin-top:10px;color:#a9b7da;font-size:12px;">
      * “접속중”은 오늘 로그 기준(enter/leave 마지막 이벤트)으로 계산합니다.
    </div>
  </div>
</div>


  <div class="wrap">
    <div class="card">
      <h3>라이브 영상</h3>
      <iframe id="yt" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
      <div class="content muted">
        * 파일럿은 유튜브 임베드(가짜 라이브). 본개발에서 RTMP/SRT → HLS/LL-HLS + CDN으로 교체.
      </div>
    </div>

    <div class="card">
      <h3>채팅</h3>
      <div id="chatBox" class="chatBox"></div>
      <div class="inputRow">
        <input id="chatInput" placeholder="메시지 입력 (엔터)" />
        <button id="sendBtn">전송</button>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
  <script>
    PilotApp.initLivePage();
  </script>
</body>
</html>
